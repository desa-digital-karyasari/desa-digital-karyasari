<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Desa Digital Karyasari</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:"Times New Roman";background:#eef2f6;margin:0}
.container{max-width:1100px;margin:20px auto;background:#fff;padding:20px;border-radius:10px}
input,select,textarea,button{width:100%;padding:8px;margin-bottom:8px}
button{background:#1e5eff;color:#fff;border:none;border-radius:5px;cursor:pointer}
.hidden{display:none}
.surat{line-height:1.8;text-align:justify}
.ttd{text-align:right;margin-top:60px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px}
@media print{
 body *{visibility:hidden}
 #preview,#preview *{visibility:visible}
 #preview{position:absolute;top:0;left:0;width:100%}
}
</style>
</head>

<body>
<div class="container">

<h2>Desa Digital â€“ Pelayanan Surat Menyurat</h2>

<!-- LOGIN -->
<div id="login">
<h3>Login</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- FORM -->
<div id="form" class="hidden">
<h3>Pengajuan Surat</h3>
<input id="nama" placeholder="Nama Lengkap">
<input id="nik" placeholder="NIK">
<input id="tl" placeholder="Tempat Lahir">
<input id="tgl" type="date">
<select id="jk"><option>Laki-laki</option><option>Perempuan</option></select>
<select id="agama"><option>Islam</option><option>Kristen</option><option>Katolik</option><option>Hindu</option><option>Buddha</option></select>
<select id="status"><option>Belum Kawin</option><option>Kawin</option></select>
<input id="kerja" placeholder="Pekerjaan">
<textarea id="alamat" placeholder="Alamat Lengkap"></textarea>
<select id="jenis"></select>
<textarea id="keperluan" placeholder="Keperluan"></textarea>
<button onclick="buatSurat()">Buat Surat</button>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
<h3>Panel Admin</h3>
<input id="kades" placeholder="Nama Kepala Desa">
<input id="nip" placeholder="NIP (Opsional)">
<button onclick="setujui()">Setujui Surat</button>
<button onclick="exportExcel()">Export Excel</button>
<button onclick="lihatDashboard()">Dashboard</button>
</div>

<!-- PREVIEW -->
<div id="preview" class="hidden">
<hr>
<h3 style="text-align:center">PEMERINTAH DESA KARYASARI</h3>
<p style="text-align:center"><b id="judulSurat"></b></p>
<p>Nomor: <span id="nosurat"></span></p>

<div class="surat">
<p>Yang bertanda tangan di bawah ini Kepala Desa Karyasari menerangkan bahwa:</p>
<p>
Nama: <span id="p_nama"></span><br>
NIK: <span id="p_nik"></span><br>
TTL: <span id="p_ttl"></span><br>
Jenis Kelamin: <span id="p_jk"></span><br>
Agama: <span id="p_agama"></span><br>
Status: <span id="p_status"></span><br>
Pekerjaan: <span id="p_kerja"></span><br>
Alamat: <span id="p_alamat"></span>
</p>
<p>Keperluan: <b><span id="p_keperluan"></span></b></p>

<div class="ttd">
<p>Karyasari, <span id="tglsurat"></span></p>
<p>Kepala Desa</p><br>
<b id="ttd_nama"></b><br>
<span id="ttd_nip"></span>
</div>

<div id="qrcode"></div>
</div>

<button onclick="exportPDF()">Export PDF</button>
<button onclick="window.print()">Cetak</button>

<!-- VALIDASI -->
<div id="validasi" class="hidden">
<h3>VALIDASI SURAT</h3>
<p id="hasilValidasi"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">
<h3>Dashboard Statistik</h3>
<canvas id="chart"></canvas>
</div>

</div>

<script>
/* LOGIN DATA */
const users={
 admin:{pass:"1234",role:"admin"},
 petugas:{pass:"1234",role:"petugas"}
};
let role="";

/* 63 JENIS SURAT (DIKUNCI) */
const suratList={142:"Surat Keterangan Tidak Mampu",143:"Surat Keterangan Catatan Kepolisian",144:"Surat Keterangan Usaha",145:"Surat Keterangan Domisili",146:"Surat Keterangan Kelahiran",147:"Surat Keterangan Kematian",148:"Surat Keterangan Pindah",149:"Surat Keterangan Datang",150:"Surat Keterangan Belum Menikah",151:"Surat Keterangan Janda/Duda",152:"Surat Keterangan Ahli Waris",153:"Surat Keterangan Tanah",154:"Surat Keterangan Penghasilan",155:"Surat Keterangan Beda Nama",156:"Surat Keterangan Kehilangan",157:"Surat Izin Keramaian",158:"Surat Izin Usaha",159:"Surat Keterangan Beasiswa",160:"Surat Keterangan Disabilitas",161:"Surat Keterangan Lansia",162:"Surat Keterangan Domisili Usaha",163:"Surat Rekomendasi Nikah",164:"Surat Pengantar KUA",165:"Surat Pengantar SKCK",166:"Surat Pengantar BPJS",167:"Surat Pengantar Bank",168:"Surat Pengantar Sekolah",169:"Surat Keterangan Tidak Bekerja",170:"Surat Keterangan Kerja",171:"Surat Keterangan Miskin",172:"Surat Keterangan Tidak Menerima Bantuan",173:"Surat Keterangan Penerima Bantuan",174:"Surat Keterangan Bedah Rumah",175:"Surat Keterangan Tanah Hibah",176:"Surat Keterangan Waris Tanah",177:"Surat Keterangan Silsilah",178:"Surat Keterangan Penguasaan Tanah",179:"Surat Keterangan Rumah Tinggal",180:"Surat Keterangan Domisili Lembaga",181:"Surat Keterangan Yayasan",182:"Surat Keterangan Organisasi",183:"Surat Keterangan Kehadiran",184:"Surat Keterangan Aktif",185:"Surat Keterangan Non Aktif",186:"Surat Keterangan Kehilangan Dokumen",187:"Surat Keterangan Pindah Sekolah",188:"Surat Keterangan Domisili Sementara",189:"Surat Keterangan Izin Orang Tua",190:"Surat Keterangan Wali",191:"Surat Keterangan Tanggungan",192:"Surat Keterangan Kepemilikan Rumah",193:"Surat Keterangan Kepemilikan Kendaraan",194:"Surat Keterangan Belum Punya Rumah"};

const jenis=document.getElementById("jenis");
for(let k in suratList){let o=document.createElement("option");o.value=k;o.textContent=suratList[k];jenis.appendChild(o);}

let arsip=JSON.parse(localStorage.getItem("arsip")||"[]");
let urut=arsip.length+1;

function login(){
 let u=user.value;
 if(users[u] && users[u].pass==pass.value){
  role=users[u].role;
  login.style.display="none";
  form.classList.remove("hidden");
  if(role=="admin") admin.classList.remove("hidden");
 }
}

function buatSurat(){
 let d=new Date();
 let no=`${jenis.value}/${String(urut++).padStart(3,"0")}/Ds.2001/${d.getMonth()+1}/${d.getFullYear()}`;
 let data={no,nama:nama.value,jenis:suratList[jenis.value],tgl:d.toISOString(),status:"SAH"};
 arsip.push(data);
 localStorage.setItem("arsip",JSON.stringify(arsip));

 nosurat.textContent=no;
 judulSurat.textContent=data.jenis;
 p_nama.textContent=nama.value;
 p_nik.textContent=nik.value;
 p_ttl.textContent=tl.value+" "+tgl.value;
 p_jk.textContent=jk.value;
 p_agama.textContent=agama.value;
 p_status.textContent=status.value;
 p_kerja.textContent=kerja.value;
 p_alamat.textContent=alamat.value;
 p_keperluan.textContent=keperluan.value;
 tglsurat.textContent=d.toLocaleDateString("id-ID");

 qrcode.innerHTML="";
 new QRCode(qrcode,{text:no,width:120,height:120});

 preview.classList.remove("hidden");
}

function setujui(){
 ttd_nama.textContent=kades.value;
 ttd_nip.textContent=nip.value;
}

function exportPDF(){
 const {jsPDF}=window.jspdf;
 let pdf=new jsPDF();
 pdf.html(preview,{callback:d=>d.save("surat.pdf")});
}

function exportExcel(){
 let csv="Nomor,Nama,Jenis,Tanggal\n";
 arsip.forEach(a=>csv+=`${a.no},${a.nama},${a.jenis},${a.tgl}\n`);
 let blob=new Blob([csv],{type:"text/csv"});
 let a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="arsip_surat.csv";
 a.click();
}

function lihatDashboard(){
 dashboard.classList.remove("hidden");
 let stat={};
 arsip.forEach(a=>{
  let y=new Date(a.tgl).getFullYear();
  stat[y]=(stat[y]||0)+1;
 });
 new Chart(chart,{type:"bar",data:{labels:Object.keys(stat),datasets:[{data:Object.values(stat)}]}});
}
</script>
</body>
</html>
